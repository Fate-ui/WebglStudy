var C=Object.defineProperty;var S=(n,e,t)=>e in n?C(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var w=(n,e,t)=>(S(n,typeof e!="symbol"?e+"":e,t),t);import{r as _,E as T,T as R,a5 as x,i as D,K as M,e as k,S as E,P as B,W as F,h as N,j as P,m as W}from"./three.module-2f5a30fe.js";import{O as X}from"./OrbitControls-27c6eec7.js";import{a as z}from"./index-3c33305c.js";import{F as G}from"./FBXLoader-1e225398.js";import{d as I}from"./index-1a26f821.js";import{d as O,s as U,l as Y,p as j,o as V,c as H,h,F as J}from"./index-c6fb5685.js";class K{constructor(){w(this,"updateData",()=>{if(!this.isStart)return!1;const e=this.clock.getDelta();this.time.value+=e,this.startTime.value+=e,this.texture.offset.x=this.time.value/3,this.texture.offset.y=this.time.value/3,this.startTime.value>=this.startLength.value&&(this.startTime.value=this.startLength.value)});this.fbxLoader=new G,this.group=new _,this.clock=new T,this.time={value:0},this.startTime={value:0},this.startLength={value:2},this.isStart=!1,this.fbxLoader.load("model/shanghai.FBX",e=>{this.group.add(e),e.traverse(t=>{t.name==="CITY_UNTRIANGULATED"&&(Array.isArray(t.material)?t.material:[t.material]).forEach(s=>{s.transparent=!0,s.color.setStyle("#9370DB")}),t.name==="LANDMASS"&&(Array.isArray(t.material)?t.material:[t.material]).forEach(s=>{s.transparent=!0,s.color.setStyle("#040912")}),t.name==="ROADS"&&(this.texture=this.changeColor(t))}),this.init()})}init(){this.isStart=!0,this.clock.start()}changeColor(e){const t=new R().load("texture/flowLight.png");t.wrapS=x,t.wrapT=x,t.repeat.set(1,1);const i=new D({map:t,normalScale:new M(5,5)}),s=e.geometry,r=s.attributes.position,o=r.count,l=[],c=[];for(let a=0;a<o;a++)l.push(r.getX(a)),c.push(r.getY(a));function m(a){return a.sort(d),[a[0],a[a.length-1]]}function d(a,u){return a<u?-1:a>u?1:0}const[f,v]=m(l),[g,y]=m(c),L=v-f,A=y-g,p=new Float32Array(o*2);for(let a=0;a<o;a++){const u=(r.getX(a)-f)/L,b=(r.getY(a)-g)/A;p[a*2]=u,p[a*2+1]=b}return s.setAttribute("uv",new k(p,2)),e.material=i,t}}const $=K,q=h("div",{class:"fixed left-20px top-20px px-20px leading-50px z-1 bg-white rounded"},[h("span",null,"学习来源："),h("a",{href:"https://blog.csdn.net/u010568976/article/details/123902662",target:"_blank",class:"text-blue"},"threejs道路贴图动画")],-1),nt=O({__name:"Index",setup(n){const e={width:window.innerWidth,height:window.innerHeight},t=new E,i=new B(50,e.width/e.height,1,1e4);i.position.set(600,750,-1221);const s=new F({antialias:!0,alpha:!0});s.setSize(e.width,e.height),s.setPixelRatio(window.devicePixelRatio),s.setClearColor(new N("#32373E"),1);const r=U();Y(()=>{r.value.appendChild(s.domElement)});const o=new X(i,s.domElement);o.enableDamping=!0,t.add(new P(11382189));const l=new W(16777215,5);l.position.set(100,100,0),t.add(l);const c=new $;return t.add(c.group),z(()=>{c.updateData(),o.update(),s.render(t,i)}),j(()=>{I(t,s)}),(m,d)=>(V(),H(J,null,[h("div",{ref_key:"containerRef",ref:r},null,512),q],64))}});export{nt as default};

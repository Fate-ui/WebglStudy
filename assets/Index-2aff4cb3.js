import"./base-3bd7cb41.js";import{L as te,w as se,d as ne,V as O,q as R,x as ie,b as oe,v as L,O as ae,y as re,z as K,T as ce,U as le,g as me,S as he,P as de,W as ue,j as pe,m as fe,n as ve,E as ge}from"./three.module-a9580ee8.js";import{G as we}from"./GLTFLoader-f79a8b9f.js";import{O as ye}from"./OrbitControls-44e46930.js";import{u as $}from"./index-0c0d7ccc.js";import{D as be}from"./DRACOLoader-58eba818.js";import{G as Ae}from"./dat.gui.module-5ea4ba08.js";import{k as G,m as ke,v as xe,x as Be,d as Y,y as P,w as _e,z as Z,q as Se,A as Ce,T as We,B as J,C as Q,D as X,E as Le,G as Fe,s as De,l as Ie,p as Me,o as Te,c as Re}from"./index-638dfcb3.js";import{r as E,i as Pe,g as U,a as q}from"./style-b645f8a5.js";import{u as Ue}from"./use-global-config-513c45c8.js";function je(o){let e;const t=G(!1),s=ke({...o,originalPosition:"",originalOverflow:"",visible:!1});function n(c){s.text=c}function i(){const c=s.parent,u=h.ns;if(!c.vLoadingAddClassList){let v=c.getAttribute("loading-number");v=Number.parseInt(v)-1,v?c.setAttribute("loading-number",v.toString()):(E(c,u.bm("parent","relative")),c.removeAttribute("loading-number")),E(c,u.bm("parent","hidden"))}l(),p.unmount()}function l(){var c,u;(u=(c=h.$el)==null?void 0:c.parentNode)==null||u.removeChild(h.$el)}function a(){var c;o.beforeClose&&!o.beforeClose()||(t.value=!0,clearTimeout(e),e=window.setTimeout(r,400),s.visible=!1,(c=o.closed)==null||c.call(o))}function r(){if(!t.value)return;const c=s.parent;t.value=!1,c.vLoadingAddClassList=void 0,i()}const m=Y({name:"ElLoading",setup(c,{expose:u}){const{ns:v,zIndex:F}=Ue("loading");return u({ns:v,zIndex:F}),()=>{const S=s.spinner||s.svg,C=P("svg",{class:"circular",viewBox:s.svgViewBox?s.svgViewBox:"0 0 50 50",...S?{innerHTML:S}:{}},[P("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})]),D=s.text?P("p",{class:v.b("text")},[s.text]):void 0;return P(We,{name:v.b("fade"),onAfterLeave:r},{default:_e(()=>[Z(Se("div",{style:{backgroundColor:s.background||""},class:[v.b("mask"),s.customClass,s.fullscreen?"is-fullscreen":""]},[P("div",{class:v.b("spinner")},[C,D])]),[[Ce,s.visible]])])})}}}),p=xe(m),h=p.mount(document.createElement("div"));return{...Be(s),setText:n,removeElLoadingChild:l,close:a,handleAfterLeave:r,vm:h,get $el(){return h.$el}}}let z;const ze=function(o={}){if(!Pe)return;const e=Oe(o);if(e.fullscreen&&z)return z;const t=je({...e,closed:()=>{var n;(n=e.closed)==null||n.call(e),e.fullscreen&&(z=void 0)}});Ee(e,e.parent,t),H(e,e.parent,t),e.parent.vLoadingAddClassList=()=>H(e,e.parent,t);let s=e.parent.getAttribute("loading-number");return s?s=`${Number.parseInt(s)+1}`:s="1",e.parent.setAttribute("loading-number",s),e.parent.appendChild(t.$el),J(()=>t.visible.value=e.visible),e.fullscreen&&(z=t),t},Oe=o=>{var e,t,s,n;let i;return Q(o.target)?i=(e=document.querySelector(o.target))!=null?e:document.body:i=o.target||document.body,{parent:i===document.body||o.body?document.body:i,background:o.background||"",svg:o.svg||"",svgViewBox:o.svgViewBox||"",spinner:o.spinner||!1,text:o.text||"",fullscreen:i===document.body&&((t=o.fullscreen)!=null?t:!0),lock:(s=o.lock)!=null?s:!1,customClass:o.customClass||"",visible:(n=o.visible)!=null?n:!0,target:i}},Ee=async(o,e,t)=>{const{nextZIndex:s}=t.vm.zIndex||t.vm._.exposed.zIndex,n={};if(o.fullscreen)t.originalPosition.value=U(document.body,"position"),t.originalOverflow.value=U(document.body,"overflow"),n.zIndex=s();else if(o.parent===document.body){t.originalPosition.value=U(document.body,"position"),await J();for(const i of["top","left"]){const l=i==="top"?"scrollTop":"scrollLeft";n[i]=`${o.target.getBoundingClientRect()[i]+document.body[l]+document.documentElement[l]-Number.parseInt(U(document.body,`margin-${i}`),10)}px`}for(const i of["height","width"])n[i]=`${o.target.getBoundingClientRect()[i]}px`}else t.originalPosition.value=U(e,"position");for(const[i,l]of Object.entries(n))t.$el.style[i]=l},H=(o,e,t)=>{const s=t.vm.ns||t.vm._.exposed.ns;["absolute","fixed","sticky"].includes(t.originalPosition.value)?E(e,s.bm("parent","relative")):q(e,s.bm("parent","relative")),o.fullscreen&&o.lock?q(e,s.bm("parent","hidden")):E(e,s.bm("parent","hidden"))},V=Symbol("ElLoading"),N=(o,e)=>{var t,s,n,i;const l=e.instance,a=c=>X(e.value)?e.value[c]:void 0,r=c=>{const u=Q(c)&&(l==null?void 0:l[c])||c;return u&&G(u)},m=c=>r(a(c)||o.getAttribute(`element-loading-${Fe(c)}`)),p=(t=a("fullscreen"))!=null?t:e.modifiers.fullscreen,h={text:m("text"),svg:m("svg"),svgViewBox:m("svgViewBox"),spinner:m("spinner"),background:m("background"),customClass:m("customClass"),fullscreen:p,target:(s=a("target"))!=null?s:p?void 0:o,body:(n=a("body"))!=null?n:e.modifiers.body,lock:(i=a("lock"))!=null?i:e.modifiers.lock};o[V]={options:h,instance:ze(h)}},Ve=(o,e)=>{for(const t of Object.keys(e))Le(e[t])&&(e[t].value=o[t])},Ge={mounted(o,e){e.value&&N(o,e)},updated(o,e){const t=o[V];e.oldValue!==e.value&&(e.value&&!e.oldValue?N(o,e):e.value&&e.oldValue?X(e.value)&&Ve(e.value,t.options):t==null||t.instance.close())},unmounted(o){var e;(e=o[V])==null||e.instance.close()}};const Ke=[[-.525731,0,.850651],[-.442863,.238856,.864188],[-.295242,0,.955423],[-.309017,.5,.809017],[-.16246,.262866,.951056],[0,0,1],[0,.850651,.525731],[-.147621,.716567,.681718],[.147621,.716567,.681718],[0,.525731,.850651],[.309017,.5,.809017],[.525731,0,.850651],[.295242,0,.955423],[.442863,.238856,.864188],[.16246,.262866,.951056],[-.681718,.147621,.716567],[-.809017,.309017,.5],[-.587785,.425325,.688191],[-.850651,.525731,0],[-.864188,.442863,.238856],[-.716567,.681718,.147621],[-.688191,.587785,.425325],[-.5,.809017,.309017],[-.238856,.864188,.442863],[-.425325,.688191,.587785],[-.716567,.681718,-.147621],[-.5,.809017,-.309017],[-.525731,.850651,0],[0,.850651,-.525731],[-.238856,.864188,-.442863],[0,.955423,-.295242],[-.262866,.951056,-.16246],[0,1,0],[0,.955423,.295242],[-.262866,.951056,.16246],[.238856,.864188,.442863],[.262866,.951056,.16246],[.5,.809017,.309017],[.238856,.864188,-.442863],[.262866,.951056,-.16246],[.5,.809017,-.309017],[.850651,.525731,0],[.716567,.681718,.147621],[.716567,.681718,-.147621],[.525731,.850651,0],[.425325,.688191,.587785],[.864188,.442863,.238856],[.688191,.587785,.425325],[.809017,.309017,.5],[.681718,.147621,.716567],[.587785,.425325,.688191],[.955423,.295242,0],[1,0,0],[.951056,.16246,.262866],[.850651,-.525731,0],[.955423,-.295242,0],[.864188,-.442863,.238856],[.951056,-.16246,.262866],[.809017,-.309017,.5],[.681718,-.147621,.716567],[.850651,0,.525731],[.864188,.442863,-.238856],[.809017,.309017,-.5],[.951056,.16246,-.262866],[.525731,0,-.850651],[.681718,.147621,-.716567],[.681718,-.147621,-.716567],[.850651,0,-.525731],[.809017,-.309017,-.5],[.864188,-.442863,-.238856],[.951056,-.16246,-.262866],[.147621,.716567,-.681718],[.309017,.5,-.809017],[.425325,.688191,-.587785],[.442863,.238856,-.864188],[.587785,.425325,-.688191],[.688191,.587785,-.425325],[-.147621,.716567,-.681718],[-.309017,.5,-.809017],[0,.525731,-.850651],[-.525731,0,-.850651],[-.442863,.238856,-.864188],[-.295242,0,-.955423],[-.16246,.262866,-.951056],[0,0,-1],[.295242,0,-.955423],[.16246,.262866,-.951056],[-.442863,-.238856,-.864188],[-.309017,-.5,-.809017],[-.16246,-.262866,-.951056],[0,-.850651,-.525731],[-.147621,-.716567,-.681718],[.147621,-.716567,-.681718],[0,-.525731,-.850651],[.309017,-.5,-.809017],[.442863,-.238856,-.864188],[.16246,-.262866,-.951056],[.238856,-.864188,-.442863],[.5,-.809017,-.309017],[.425325,-.688191,-.587785],[.716567,-.681718,-.147621],[.688191,-.587785,-.425325],[.587785,-.425325,-.688191],[0,-.955423,-.295242],[0,-1,0],[.262866,-.951056,-.16246],[0,-.850651,.525731],[0,-.955423,.295242],[.238856,-.864188,.442863],[.262866,-.951056,.16246],[.5,-.809017,.309017],[.716567,-.681718,.147621],[.525731,-.850651,0],[-.238856,-.864188,-.442863],[-.5,-.809017,-.309017],[-.262866,-.951056,-.16246],[-.850651,-.525731,0],[-.716567,-.681718,-.147621],[-.716567,-.681718,.147621],[-.525731,-.850651,0],[-.5,-.809017,.309017],[-.238856,-.864188,.442863],[-.262866,-.951056,.16246],[-.864188,-.442863,.238856],[-.809017,-.309017,.5],[-.688191,-.587785,.425325],[-.681718,-.147621,.716567],[-.442863,-.238856,.864188],[-.587785,-.425325,.688191],[-.309017,-.5,.809017],[-.147621,-.716567,.681718],[-.425325,-.688191,.587785],[-.16246,-.262866,.951056],[.442863,-.238856,.864188],[.16246,-.262866,.951056],[.309017,-.5,.809017],[.147621,-.716567,.681718],[0,-.525731,.850651],[.425325,-.688191,.587785],[.587785,-.425325,.688191],[.688191,-.587785,.425325],[-.955423,.295242,0],[-.951056,.16246,.262866],[-1,0,0],[-.850651,0,.525731],[-.955423,-.295242,0],[-.951056,-.16246,.262866],[-.864188,.442863,-.238856],[-.951056,.16246,-.262866],[-.809017,.309017,-.5],[-.864188,-.442863,-.238856],[-.951056,-.16246,-.262866],[-.809017,-.309017,-.5],[-.681718,.147621,-.716567],[-.681718,-.147621,-.716567],[-.850651,0,-.525731],[-.688191,.587785,-.425325],[-.587785,.425325,-.688191],[-.425325,.688191,-.587785],[-.425325,-.688191,-.587785],[-.587785,-.425325,-.688191],[-.688191,-.587785,-.425325]];class $e extends te{constructor(e){super(e)}load(e,t,s,n){const i=this,l=new se(i.manager);l.setPath(i.path),l.setResponseType("arraybuffer"),l.setRequestHeader(i.requestHeader),l.setWithCredentials(i.withCredentials),l.load(e,function(a){try{t(i.parse(a))}catch(r){n?n(r):console.error(r),i.manager.itemError(e)}},s,n)}parse(e){const t=new DataView(e),s={},n=["ident","version","skinwidth","skinheight","framesize","num_skins","num_vertices","num_st","num_tris","num_glcmds","num_frames","offset_skins","offset_st","offset_tris","offset_frames","offset_glcmds","offset_end"];for(let d=0;d<n.length;d++)s[n[d]]=t.getInt32(d*4,!0);if(s.ident!==844121161||s.version!==8){console.error("Not a valid MD2 file");return}if(s.offset_end!==t.byteLength){console.error("Corrupted MD2 file");return}const i=new ne,l=[];let a=s.offset_st;for(let d=0,b=s.num_st;d<b;d++){const w=t.getInt16(a+0,!0),f=t.getInt16(a+2,!0);l.push(w/s.skinwidth,1-f/s.skinheight),a+=4}a=s.offset_tris;const r=[],m=[];for(let d=0,b=s.num_tris;d<b;d++)r.push(t.getUint16(a+0,!0),t.getUint16(a+2,!0),t.getUint16(a+4,!0)),m.push(t.getUint16(a+6,!0),t.getUint16(a+8,!0),t.getUint16(a+10,!0)),a+=12;const p=new O,h=new O,c=[];a=s.offset_frames;for(let d=0,b=s.num_frames;d<b;d++){h.set(t.getFloat32(a+0,!0),t.getFloat32(a+4,!0),t.getFloat32(a+8,!0)),p.set(t.getFloat32(a+12,!0),t.getFloat32(a+16,!0),t.getFloat32(a+20,!0)),a+=24;const w=[];for(let y=0;y<16;y++){const A=t.getUint8(a+y);if(A===0)break;w[y]=A}const f={name:String.fromCharCode.apply(null,w),vertices:[],normals:[]};a+=16;for(let y=0;y<s.num_vertices;y++){let A=t.getUint8(a++),k=t.getUint8(a++),B=t.getUint8(a++);const W=Ke[t.getUint8(a++)];A=A*h.x+p.x,k=k*h.y+p.y,B=B*h.z+p.z,f.vertices.push(A,B,k),f.normals.push(W[0],W[2],W[1])}c.push(f)}const u=[],v=[],F=[],S=c[0].vertices,C=c[0].normals;for(let d=0,b=r.length;d<b;d++){let f=r[d]*3;const y=S[f],A=S[f+1],k=S[f+2];u.push(y,A,k);const B=C[f],W=C[f+1],_=C[f+2];v.push(B,W,_),f=m[d]*2;const M=l[f],T=l[f+1];F.push(M,T)}i.setAttribute("position",new R(u,3)),i.setAttribute("normal",new R(v,3)),i.setAttribute("uv",new R(F,2));const D=[],g=[];for(let d=0,b=c.length;d<b;d++){const w=c[d],f=w.name;if(w.vertices.length>0){const y=[];for(let k=0,B=r.length;k<B;k++){const _=r[k]*3,j=w.vertices[_],M=w.vertices[_+1],T=w.vertices[_+2];y.push(j,M,T)}const A=new R(y,3);A.name=f,D.push(A)}if(w.normals.length>0){const y=[];for(let k=0,B=r.length;k<B;k++){const _=r[k]*3,j=w.normals[_],M=w.normals[_+1],T=w.normals[_+2];y.push(j,M,T)}const A=new R(y,3);A.name=f,g.push(A)}}return i.morphAttributes.position=D,i.morphAttributes.normal=g,i.morphTargetsRelative=!1,i.animations=ie.CreateClipsFromMorphTargetSequences(c,10),i}}class qe extends oe{constructor(e,t){super(e,t),this.animationsMap={},this.animationsList=[];const s=Object.keys(this.morphTargetDictionary).length,n="__default",i=0,l=s-1,a=s/1;this.createAnimation(n,i,l,a),this.setAnimationWeight(n,1)}createAnimation(e,t,s,n){const i={start:t,end:s,length:s-t+1,fps:n,duration:(s-t)/n,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=i,this.animationsList.push(i)}autoCreateAnimations(e){const t=/([a-z]+)_?(\d+)/i;let s;const n={};let i=0;for(const l in this.morphTargetDictionary){const a=l.match(t);if(a&&a.length>1){const r=a[1];n[r]||(n[r]={start:1/0,end:-1/0});const m=n[r];i<m.start&&(m.start=i),i>m.end&&(m.end=i),s||(s=r)}i++}for(const l in n){const a=n[l];this.createAnimation(l,a.start,a.end,e)}this.firstAnimation=s}setAnimationDirectionForward(e){const t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)}setAnimationDirectionBackward(e){const t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)}setAnimationFPS(e,t){const s=this.animationsMap[e];s&&(s.fps=t,s.duration=(s.end-s.start)/s.fps)}setAnimationDuration(e,t){const s=this.animationsMap[e];s&&(s.duration=t,s.fps=(s.end-s.start)/s.duration)}setAnimationWeight(e,t){const s=this.animationsMap[e];s&&(s.weight=t)}setAnimationTime(e,t){const s=this.animationsMap[e];s&&(s.time=t)}getAnimationTime(e){let t=0;const s=this.animationsMap[e];return s&&(t=s.time),t}getAnimationDuration(e){let t=-1;const s=this.animationsMap[e];return s&&(t=s.duration),t}playAnimation(e){const t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("THREE.MorphBlendMesh: animation["+e+"] undefined in .playAnimation()")}stopAnimation(e){const t=this.animationsMap[e];t&&(t.active=!1)}update(e){for(let t=0,s=this.animationsList.length;t<s;t++){const n=this.animationsList[t];if(!n.active)continue;const i=n.duration/n.length;n.time+=n.direction*e,n.mirroredLoop?(n.time>n.duration||n.time<0)&&(n.direction*=-1,n.time>n.duration&&(n.time=n.duration,n.directionBackwards=!0),n.time<0&&(n.time=0,n.directionBackwards=!1)):(n.time=n.time%n.duration,n.time<0&&(n.time+=n.duration));const l=n.start+L.clamp(Math.floor(n.time/i),0,n.length-1),a=n.weight;l!==n.currentFrame&&(this.morphTargetInfluences[n.lastFrame]=0,this.morphTargetInfluences[n.currentFrame]=1*a,this.morphTargetInfluences[l]=0,n.lastFrame=n.currentFrame,n.currentFrame=l);let r=n.time%i/i;n.directionBackwards&&(r=1-r),n.currentFrame!==n.lastFrame?(this.morphTargetInfluences[n.currentFrame]=r*a,this.morphTargetInfluences[n.lastFrame]=(1-r)*a):this.morphTargetInfluences[n.currentFrame]=a}}}class He{constructor(){this.scale=1,this.animationFPS=6,this.transitionFrames=15,this.maxSpeed=275,this.maxReverseSpeed=-275,this.frontAcceleration=600,this.backAcceleration=600,this.frontDecceleration=600,this.angularSpeed=2.5,this.root=new ae,this.meshBody=null,this.meshWeapon=null,this.controls=null,this.skinsBody=[],this.skinsWeapon=[],this.weapons=[],this.currentSkin=void 0,this.onLoadComplete=function(){},this.meshes=[],this.animations={},this.loadCounter=0,this.speed=0,this.bodyOrientation=0,this.walkSpeed=this.maxSpeed,this.crouchSpeed=this.maxSpeed*.5,this.activeAnimation=null,this.oldAnimation=null}enableShadows(e){for(let t=0;t<this.meshes.length;t++)this.meshes[t].castShadow=e,this.meshes[t].receiveShadow=e}setVisible(e){for(let t=0;t<this.meshes.length;t++)this.meshes[t].visible=e,this.meshes[t].visible=e}shareParts(e){this.animations=e.animations,this.walkSpeed=e.walkSpeed,this.crouchSpeed=e.crouchSpeed,this.skinsBody=e.skinsBody,this.skinsWeapon=e.skinsWeapon;const t=this._createPart(e.meshBody.geometry,this.skinsBody[0]);t.scale.set(this.scale,this.scale,this.scale),this.root.position.y=e.root.position.y,this.root.add(t),this.meshBody=t,this.meshes.push(t);for(let s=0;s<e.weapons.length;s++){const n=this._createPart(e.weapons[s].geometry,this.skinsWeapon[s]);n.scale.set(this.scale,this.scale,this.scale),n.visible=!1,n.name=e.weapons[s].name,this.root.add(n),this.weapons[s]=n,this.meshWeapon=n,this.meshes.push(n)}}loadParts(e){const t=this;function s(r,m){const p=new ce,h=[];for(let c=0;c<m.length;c++)h[c]=p.load(r+m[c],n),h[c].mapping=le,h[c].name=m[c],h[c].colorSpace=me;return h}function n(){t.loadCounter-=1,t.loadCounter===0&&t.onLoadComplete()}this.animations=e.animations,this.walkSpeed=e.walkSpeed,this.crouchSpeed=e.crouchSpeed,this.loadCounter=e.weapons.length*2+e.skins.length+1;const i=[];for(let r=0;r<e.weapons.length;r++)i[r]=e.weapons[r][1];this.skinsBody=s(e.baseUrl+"skins/",e.skins),this.skinsWeapon=s(e.baseUrl+"skins/",i);const l=new $e;l.load(e.baseUrl+e.body,function(r){const m=new re;m.setFromBufferAttribute(r.attributes.position),t.root.position.y=-t.scale*m.min.y;const p=t._createPart(r,t.skinsBody[0]);p.scale.set(t.scale,t.scale,t.scale),t.root.add(p),t.meshBody=p,t.meshes.push(p),n()});const a=function(r,m){return function(p){const h=t._createPart(p,t.skinsWeapon[r]);h.scale.set(t.scale,t.scale,t.scale),h.visible=!1,h.name=m,t.root.add(h),t.weapons[r]=h,t.meshWeapon=h,t.meshes.push(h),n()}};for(let r=0;r<e.weapons.length;r++)l.load(e.baseUrl+e.weapons[r][0],a(r,e.weapons[r][0]))}setPlaybackRate(e){this.meshBody&&(this.meshBody.duration=this.meshBody.baseDuration/e),this.meshWeapon&&(this.meshWeapon.duration=this.meshWeapon.baseDuration/e)}setWireframe(e){e?(this.meshBody&&(this.meshBody.material=this.meshBody.materialWireframe),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialWireframe)):(this.meshBody&&(this.meshBody.material=this.meshBody.materialTexture),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialTexture))}setSkin(e){this.meshBody&&this.meshBody.material.wireframe===!1&&(this.meshBody.material.map=this.skinsBody[e],this.currentSkin=e)}setWeapon(e){for(let s=0;s<this.weapons.length;s++)this.weapons[s].visible=!1;const t=this.weapons[e];t&&(t.visible=!0,this.meshWeapon=t,this.activeAnimation&&(t.playAnimation(this.activeAnimation),this.meshWeapon.setAnimationTime(this.activeAnimation,this.meshBody.getAnimationTime(this.activeAnimation))))}setAnimation(e){e===this.activeAnimation||!e||(this.meshBody&&(this.meshBody.setAnimationWeight(e,0),this.meshBody.playAnimation(e),this.oldAnimation=this.activeAnimation,this.activeAnimation=e,this.blendCounter=this.transitionFrames),this.meshWeapon&&(this.meshWeapon.setAnimationWeight(e,0),this.meshWeapon.playAnimation(e)))}update(e){this.controls&&this.updateMovementModel(e),this.animations&&(this.updateBehaviors(),this.updateAnimations(e))}updateAnimations(e){let t=1;this.blendCounter>0&&(t=(this.transitionFrames-this.blendCounter)/this.transitionFrames,this.blendCounter-=1),this.meshBody&&(this.meshBody.update(e),this.meshBody.setAnimationWeight(this.activeAnimation,t),this.meshBody.setAnimationWeight(this.oldAnimation,1-t)),this.meshWeapon&&(this.meshWeapon.update(e),this.meshWeapon.setAnimationWeight(this.activeAnimation,t),this.meshWeapon.setAnimationWeight(this.oldAnimation,1-t))}updateBehaviors(){const e=this.controls,t=this.animations;let s,n;e.crouch?(s=t.crouchMove,n=t.crouchIdle):(s=t.move,n=t.idle),e.jump&&(s=t.jump,n=t.jump),e.attack&&(e.crouch?(s=t.crouchAttack,n=t.crouchAttack):(s=t.attack,n=t.attack)),(e.moveForward||e.moveBackward||e.moveLeft||e.moveRight)&&this.activeAnimation!==s&&this.setAnimation(s),Math.abs(this.speed)<.2*this.maxSpeed&&!(e.moveLeft||e.moveRight||e.moveForward||e.moveBackward)&&this.activeAnimation!==n&&this.setAnimation(n),e.moveForward&&(this.meshBody&&(this.meshBody.setAnimationDirectionForward(this.activeAnimation),this.meshBody.setAnimationDirectionForward(this.oldAnimation)),this.meshWeapon&&(this.meshWeapon.setAnimationDirectionForward(this.activeAnimation),this.meshWeapon.setAnimationDirectionForward(this.oldAnimation))),e.moveBackward&&(this.meshBody&&(this.meshBody.setAnimationDirectionBackward(this.activeAnimation),this.meshBody.setAnimationDirectionBackward(this.oldAnimation)),this.meshWeapon&&(this.meshWeapon.setAnimationDirectionBackward(this.activeAnimation),this.meshWeapon.setAnimationDirectionBackward(this.oldAnimation)))}updateMovementModel(e){function t(l){return l===1?1:-Math.pow(2,-10*l)+1}const s=this.controls;s.crouch?this.maxSpeed=this.crouchSpeed:this.maxSpeed=this.walkSpeed,this.maxReverseSpeed=-this.maxSpeed,s.moveForward&&(this.speed=L.clamp(this.speed+e*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed)),s.moveBackward&&(this.speed=L.clamp(this.speed-e*this.backAcceleration,this.maxReverseSpeed,this.maxSpeed));const n=1;if(s.moveLeft&&(this.bodyOrientation+=e*this.angularSpeed,this.speed=L.clamp(this.speed+n*e*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed)),s.moveRight&&(this.bodyOrientation-=e*this.angularSpeed,this.speed=L.clamp(this.speed+n*e*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed)),!(s.moveForward||s.moveBackward))if(this.speed>0){const l=t(this.speed/this.maxSpeed);this.speed=L.clamp(this.speed-l*e*this.frontDecceleration,0,this.maxSpeed)}else{const l=t(this.speed/this.maxReverseSpeed);this.speed=L.clamp(this.speed+l*e*this.backAcceleration,this.maxReverseSpeed,0)}const i=this.speed*e;this.root.position.x+=Math.sin(this.bodyOrientation)*i,this.root.position.z+=Math.cos(this.bodyOrientation)*i,this.root.rotation.y=this.bodyOrientation}_createPart(e,t){const s=new K({color:16755200,wireframe:!0}),n=new K({color:16777215,wireframe:!1,map:t}),i=new qe(e,n);return i.rotation.y=-Math.PI/2,i.materialTexture=n,i.materialWireframe=s,i.autoCreateAnimations(this.animationFPS),i}}const I=new Ae,x={speed:1,wireframe:!1};function Ne(o){return I.add(x,"speed",0,2).onChange(()=>{o.setPlaybackRate(x.speed)}),I.add(x,"wireframe",!1).onChange(()=>{o.setWireframe(x.wireframe)}),I}function ee(o){const e=o.split(".");return e.length>1?(e.length-=1,e.join(".")):o}function Ye(o){const e=I.addFolder("武器"),t=function(s){return function(){o.setWeapon(s),o.setWireframe(x.wireframe)}};for(let s=0;s<o.weapons.length;s++){const n=o.weapons[s].name;x[n]=t(s),e.add(x,n).name(ee(n))}}function Ze(o){const e=I.addFolder("皮肤"),t=function(s){return function(){o.setSkin(s)}};for(let s=0;s<o.skinsBody.length;s++){const n=o.skinsBody[s].name;x[n]=t(s),e.add(x,n).name(ee(n))}}function Je(o){const e=I.addFolder("动画"),t=function(n){return function(){o.setAnimation(n.name)}},s=o.meshBody.geometry.animations;for(const[n,i]of s.entries())x[i.name]=t(i),e.add(x,i.name,i.name)}const ct=Y({__name:"Index",setup(o){const e={width:window.innerWidth,height:window.innerHeight},t=new he,s=new de(45,e.width/e.height,.1,1e4),n=new ue({antialias:!0});n.setSize(e.width,e.height),n.setPixelRatio(window.devicePixelRatio),n.shadowMap.enabled=!0;const i=De();Ie(()=>{i.value.appendChild(n.domElement)});const l=new be;l.setDecoderPath("draco/");const a=G(!0),r=new we;r.setDRACOLoader(l),r.load("model/woodenHouseDraco.glb",g=>{a.value=!1;const d=g.scene;d.position.set(15,-47.8,10),t.add(d),d.children.forEach(b=>{b.receiveShadow=!0,b.castShadow=!0}),l.dispose()});const m=new He;m.scale=.03,m.onLoadComplete=()=>{Ze(m),Ye(m),Je(m);const g=m.meshBody.position.clone(),d=g.add(new O(5,3,3)).toArray();s.lookAt(g),s.position.set(...d),m.meshBody.geometry.animations,m.setAnimation(m.meshBody.geometry.animations[1].name),c.update()};function p(){if(!u.moveForward&&!u.moveBackward)return;const g=m.root.position,d=g.clone().add(new O(5,3,3)).toArray();s.position.set(...d),c.target.set(...g.toArray()),c.update()}m.loadParts({baseUrl:"model/ratamahatta/",body:"ratamahatta.md2",skins:["ratamahatta.png","ctf_b.png","ctf_r.png","dead.png","gearwhore.png"],weapons:[["weapon.md2","weapon.png"],["w_bfg.md2","w_bfg.png"],["w_blaster.md2","w_blaster.png"],["w_chaingun.md2","w_chaingun.png"],["w_glauncher.md2","w_glauncher.png"],["w_hyperblaster.md2","w_hyperblaster.png"],["w_machinegun.md2","w_machinegun.png"],["w_railgun.md2","w_railgun.png"],["w_rlauncher.md2","w_rlauncher.png"],["w_shotgun.md2","w_shotgun.png"],["w_sshotgun.md2","w_sshotgun.png"]],animations:{move:"run",idle:"stand",jump:"jump",attack:"attack",crouchMove:"cwalk",crouchIdle:"cstand",crouchAttach:"crattack"},walkSpeed:3,crouchSpeed:175}),t.add(m.root),t.add(new pe(16777215,1));const h=new fe(16777215,3);h.castShadow=!0,h.position.set(0,20,20),t.add(h),t.add(new ve(h,3));const c=new ye(s,n.domElement),u={moveForward:!1,moveBackward:!1,moveLeft:!1,moveRight:!1,crouch:!1,jump:!1};m.controls=u;function v(g){switch(g.code){case"ArrowUp":case"KeyW":u.moveForward=!0;break;case"ArrowDown":case"KeyS":u.moveBackward=!0;break;case"ArrowLeft":case"KeyA":u.moveLeft=!0;break;case"ArrowRight":case"KeyD":u.moveRight=!0;break;case"KeyC":u.crouch=!0;break;case"Space":u.jump=!0;break}}function F(g){switch(g.code){case"ArrowUp":case"KeyW":u.moveForward=!1;break;case"ArrowDown":case"KeyS":u.moveBackward=!1;break;case"ArrowLeft":case"KeyA":u.moveLeft=!1;break;case"ArrowRight":case"KeyD":u.moveRight=!1;break;case"KeyC":u.crouch=!1;break;case"Space":u.jump=!1;break}}$("keydown",v),$("keyup",F);const S=new ge;function C(){n.render(t,s),m.update(S.getDelta()),p(),requestAnimationFrame(C)}C();const D=Ne(m);return Me(()=>{D.destroy()}),(g,d)=>{const b=Ge;return Z((Te(),Re("div",{ref_key:"containerRef",ref:i},null,512)),[[b,a.value]])}}});export{ct as default};

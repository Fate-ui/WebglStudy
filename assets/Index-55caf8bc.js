var te=Object.defineProperty;var ae=(n,e,t)=>e in n?te(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var c=(n,e,t)=>(ae(n,typeof e!="symbol"?e+"":e,t),t),z=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var _=(n,e,t)=>(z(n,e,"read from private field"),t?t.call(n):e.get(n)),m=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)};var y=(n,e,t)=>(z(n,e,"access private method"),t);import{O as oe}from"./OrbitControls-e8af0deb.js";import{S as re,M as se,R as ne}from"./StaticGeometryGenerator-0ba4b1dd.js";import{V as b,y as ie,M as ce,aT as F,T as le,aU as de,b as G,f as pe,$ as he,g as $,S as ue,P as me,W as fe,a5 as ye,a as be,E as we}from"./three.module-64cab3bc.js";import{d as ge}from"./index-1a26f821.js";import{u as H}from"./index-6786e112.js";import{G as Se}from"./GLTFLoader-50cfc617.js";import{R as xe}from"./Reflector-79d58935.js";import{k as ve,d as Me,s as Re,l as Ae,p as Pe,o as Le,c as ke}from"./index-5935f0ca.js";var v,M;class Ve{constructor(e,t,a){c(this,"moveState",{forward:!1,backward:!1,left:!1,right:!1,playerIsOnGround:!0});c(this,"playerVelocity",new b);c(this,"player");c(this,"temp",{upVector:new b(0,1,0),tempVector:new b,tempVector2:new b,tempBox:new ie,tempMat:new ce,tempSegment:new F});c(this,"params",{playerSpeed:12,gravity:-50});c(this,"controls");c(this,"camera");c(this,"capsuleInfo",{radius:1,segment:new F(new b,new b(0,-5,0))});m(this,v,e=>{const{moveState:t}=this;switch(e.code){case"KeyW":case"ArrowUp":t.forward=!0;break;case"KeyS":case"ArrowDown":t.backward=!0;break;case"KeyA":case"ArrowLeft":t.left=!0;break;case"KeyD":case"ArrowRight":t.right=!0;break;case"Space":t.playerIsOnGround&&(this.playerVelocity.y=20,t.playerIsOnGround=!1)}});m(this,M,e=>{const{moveState:t}=this;switch(e.code){case"KeyW":case"ArrowUp":t.forward=!1;break;case"KeyS":case"ArrowDown":t.backward=!1;break;case"KeyA":case"ArrowLeft":t.left=!1;break;case"KeyD":case"ArrowRight":t.right=!1;break}});c(this,"reset",()=>{const{playerVelocity:e,player:t,camera:a,controls:o}=this;e.set(0,0,0),t.position.set(0,5,0),a.position.sub(o.target),o.target.copy(t.position),a.position.add(t.position),o.update()});H("keydown",_(this,v)),H("keyup",_(this,M)),this.player=e,this.controls=t,this.camera=a}updatePlayer(e,t){const{playerVelocity:a,player:o,params:r,controls:i,camera:l}=this,{playerIsOnGround:d,forward:s,backward:C,right:Y,left:Z}=this.moveState,{upVector:S,tempVector:p}=this.temp;d?a.y=e*r.gravity:a.y+=e*r.gravity,o.position.addScaledVector(a,e);const x=i.getAzimuthalAngle();s&&(p.set(0,0,-1).applyAxisAngle(S,x),o.position.addScaledVector(p,r.playerSpeed*e)),C&&(p.set(0,0,1).applyAxisAngle(S,x),o.position.addScaledVector(p,r.playerSpeed*e)),Z&&(p.set(-1,0,0).applyAxisAngle(S,x),o.position.addScaledVector(p,r.playerSpeed*e)),Y&&(p.set(1,0,0).applyAxisAngle(S,x),o.position.addScaledVector(p,r.playerSpeed*e)),o.updateMatrixWorld();const{tempBox:f,tempMat:V,tempSegment:h,tempVector2:T}=this.temp,g=this.capsuleInfo;f.makeEmpty(),V.copy(t.matrixWorld).invert(),h.copy(g.segment),h.start.applyMatrix4(o.matrixWorld).applyMatrix4(V),h.end.applyMatrix4(o.matrixWorld).applyMatrix4(V),f.expandByPoint(h.start),f.expandByPoint(h.end),f.min.addScalar(-g.radius),f.max.addScalar(g.radius),t.geometry.boundsTree.shapecast({intersectsBounds:W=>W.intersectsBox(f),intersectsTriangle:W=>{const D=p,K=T,O=W.closestPointToSegment(h,D,K);if(O<g.radius){const E=g.radius-O,j=K.sub(D).normalize();h.start.addScaledVector(j,E),h.end.addScaledVector(j,E)}}});const I=p;I.copy(h.start).applyMatrix4(t.matrixWorld);const u=T;u.subVectors(I,o.position),this.moveState.playerIsOnGround=u.y>Math.abs(e*a.y*.25);const ee=Math.max(0,u.length()-1e-5);u.normalize().multiplyScalar(ee),o.position.add(u),d?a.set(0,0,0):(u.normalize(),a.addScaledVector(u,-u.dot(a))),l.position.sub(i.target),i.target.copy(o.position),l.position.add(o.position),o.position.y<-25&&this.reset()}}v=new WeakMap,M=new WeakMap;const We=[new URL("/WebglStudy/assets/1-91d1fd28.png",self.location).href,new URL("/WebglStudy/assets/2-577e2981.png",self.location).href,new URL("/WebglStudy/assets/3-e96f4416.jpg",self.location).href,new URL("/WebglStudy/assets/4-2c59a331.jpg",self.location).href,new URL("/WebglStudy/assets/5-c8aed110.png",self.location).href,new URL("/WebglStudy/assets/6-9d09d2dc.png",self.location).href,new URL("/WebglStudy/assets/7-68ca4bc6.png",self.location).href,new URL("/WebglStudy/assets/8-74f5f15e.jpg",self.location).href,new URL("/WebglStudy/assets/9-44142f78.jpg",self.location).href,new URL("/WebglStudy/assets/10-1cde4a43.png",self.location).href],B={1:{title:"《小橘贝》",author:"小雅",describe:`
		它站在画面中央，静静地凝视着观众，柔和的橘色将它的柔软毛发和灵动眼眸妩媚地勾勒出来。<br>
		小猫的小耳朵微微竖起，似乎在倾听着什么，身体略微前倾，展现出它对周围世界的好奇和敏感。<br>
		画面的背景色以淡蓝色为主，这种色彩营造了温馨轻柔的氛围，让人仿佛置身于阳光明媚的午后时光中。<br>
		整个画作细致精致、色彩明亮而温暖，带给人们一种温馨、亲切的感受。
		`},2:{title:"《微光》",author:"小雅",describe:`
		微小的星光和银河组成了一个神秘的宇宙世界，让人感到无限的遐想和想象。<br>
		当你凝视着这幅画时，你会感受到无边无际的深邃和宁静。<br>
		你仿佛置身于一个没有噪音、没有烦扰的夜空中。在这个宁静的空间里，你可以看到银河中微光闪烁的样子。<br>
		这些微光似乎是夜空中唯一的生命体，它们微弱却坚定地发出光芒，点亮着整个银河系。<br>
		这些微光是如此的纤细而又强大，仿佛在无边的黑暗中，只有它们才能给人带来希望和力量。
		`},3:{title:"《天鹅》",author:"小雅",describe:`
		湖面静谧如镜，微风拂过，泛起一圈圈细微的涟漪，仿佛为优雅的白色天鹅们铺上了一层晶莹剔透的纱帐。<br>
		其中一只白羽如雪的天鹅在水中自由自在地舞动着优美的姿态，如同一位华丽的舞者在水上翩翩起舞。<br>
		纯白色羽毛在阳光的照射下，闪烁着淡淡的光晕，如同珍珠一般璀璨夺目。
		`},4:{title:"《山中小屋》",author:"小雅",describe:`
		宁静而恬淡，远山隐现于云雾中，仿佛是一幅梦幻般的画卷。<br>
		小屋在山脚下宁静地伫立，墙体洁白，屋顶泛着淡淡的阳光，使得小屋与周围的环境相互映衬。<br>
		流露出一种自然的和谐之美。
		`},5:{title:"《太空人》",author:"小雅",describe:`
		太空人身披着黑夜在星罗棋布的宇宙中漫游。<br>
		虽说现在已经是太空时代，人类早就可以坐太空飞船去月球，<br>
		但却永远无法探索别人内心的宇宙。
		`},6:{title:"《粉色海洋》",author:"小雅",describe:`
		粉色云朵蓬松如棉花糖展开眼前，弯月微笑在缝隙间，月光柔和，清雅动人。<br>
		紫色天空如梦，星辉闪烁，默默倾听，轻轻地，微风拂面，悄悄地，生命在流动。
		`},7:{title:"《风平浪静》",author:"小雅",describe:`
		撑一条船，离开岸边一百米，风平浪静，彩霞慢慢淡下去。<br>
		撑一条船，离开岸边两百米，风平浪静，夜晚轻轻呼唤你。<br>
		撑一条船，离开岸边三百米，风平浪静，大鱼笑我傻兮兮。<br>
		撑一条船 离开岸边四百米，风平浪静，星儿闪闪笑眯眯。<br>
		撑一条船 离开岸边五百米，风平浪静，海龟向我挥手臂。
		`},8:{title:"《向日葵》",author:"小雅",describe:`
		阳光照耀，金黄的花盘。<br>
		宛如一盏明灯，指引前行。<br>
		向日葵，你是信仰，你是力量，你是光辉，你是坚毅，你是忠诚，你是爱慕，你是美丽。
		`},9:{title:"《花·虎·蝶》",author:"小雅",describe:`
		一段奇妙的相遇，是自由和勇气的结合，是一份神秘而又动人的韵味。<br>
		在这片色彩斑斓的花海之中，一只带着蝴蝶翅膀的老虎，骑着踏板车，<br>
		它像是一道闪电，划破了这片美好的天地。<br>
		翅膀轻轻地振动，仿佛随时可以飞离这片美好的天地，飞向更广阔的天空。
		`},10:{title:"《豚》",author:"小雅",describe:`
		所有的转折隐藏在密集的鸟群中，天空与海洋都无法察觉，怀着美梦却可以看见。<br>
		摸索颠倒的一瞬间，所有的怀念隐藏在相似的日子里，心里的蜘蛛模仿人类张灯结彩
		`}},w={width:window.innerWidth,height:window.innerHeight},U=ve();var R,J,A,q,P,N,L,Q,k,X;class _e{constructor(e){m(this,R);m(this,A);m(this,P);m(this,L);m(this,k);c(this,"loader",new Se);c(this,"textureLoader",new le);c(this,"collisionScene");c(this,"textureBoards",{});c(this,"galleryBoards",{});c(this,"scene");this.scene=e,y(this,k,X).call(this),y(this,A,q).call(this);const t=[y(this,R,J).call(this),y(this,P,N).call(this)];Promise.all(t).then(()=>{y(this,L,Q).call(this)})}}R=new WeakSet,J=function(){const{loader:e,scene:t}=this;return new Promise((a,o)=>{e.load("model/scene_collision.glb",r=>{const i=r.scene;i.updateMatrixWorld(!0),this.collisionScene=i,i.traverse(s=>{(s.name==="home001"||s.name==="PointLight")&&(s.castShadow=!0),s.name.includes("PointLight")&&s instanceof de&&(s.intensity*=2e3),s.name==="home002"&&(s.castShadow=!0,s.receiveShadow=!0),s instanceof G&&/gallery.*_board/.test(s.name)&&(this.galleryBoards[s.name]=s)});const l=new re(this.collisionScene);l.attributes=["position"];const d=l.generate();d.boundsTree=new se(d),U.value=new G(d),t.add(i),a(r)})})},A=new WeakSet,q=function(){const{loader:e,scene:t}=this;return new Promise(a=>{e.load("model/scene_desk_obj.glb",o=>{const r=o.scene;t.add(r),a(o)})})},P=new WeakSet,N=async function(){const{textureLoader:e,textureBoards:t}=this,a=[];function o(r){r.colorSpace=$;const i=r.image.width/r.image.height;let l=1,d=1;i>1?l=1/i:d=i,r.offset.set(.5-l/2,.5-d/2),r.repeat.set(l,d)}for(const[r,i]of We.entries()){const l=new Promise(d=>{e.load(i,s=>{o(s),t[r+1]=s,d(s)})});a.push(l)}return await Promise.all(a),t},L=new WeakSet,Q=function(){const{textureBoards:e,galleryBoards:t}=this;for(const a in e){const o=t[`gallery${a}_board`],r=o.material;r.map=e[a],o.userData={name:o.name,title:B[a].title,author:B[a].author,describe:B[a].describe,index:a,src:e[a].image.src,show_boards:!0},[4,5,6,7,9].includes(+a)&&(o.rotation.y=-Math.PI/2),+a==8&&(o.rotation.y=Math.PI)}},k=new WeakSet,X=function(){const e=new xe(new pe(100,100),{textureWidth:w.width*window.devicePixelRatio,textureHeight:w.height*window.devicePixelRatio,color:16777215});e.material instanceof he&&(e.material.transparent=!0,e.material.fragmentShader=e.material.fragmentShader.replace("gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 )","gl_FragColor = vec4( blendOverlay( base.rgb, color ), 0.1 )")),e.rotation.x=-Math.PI/2,this.scene.add(e)};const Ee=Me({__name:"Index",setup(n){const e=new ue,t=new me(55,w.width/w.height,.1,1e3);t.position.set(0,0,3);const a=new fe({antialias:!0});a.setSize(w.width,w.height),a.setPixelRatio(window.devicePixelRatio),a.shadowMap.enabled=!0,a.outputColorSpace=$,a.toneMapping=ye;const o=Re();Ae(()=>{o.value.appendChild(a.domElement)});const r=new oe(t,a.domElement);r.minDistance=1e-4,r.maxDistance=1e-4,new _e(e);const i=new G(new ne(.5,2.5,.5,10,1),new be({color:255}));i.geometry.translate(0,-.25,0);const l=new Ve(i,r,t);l.reset(),e.add(i);const d=new we;return a.setAnimationLoop(()=>{a.render(e,t),r.update();const s=Math.min(d.getDelta(),.05);U.value&&l.updatePlayer(s,U.value)}),Pe(()=>{ge(e,a)}),(s,C)=>(Le(),ke("div",{ref_key:"containerRef",ref:o},null,512))}});export{Ee as default};

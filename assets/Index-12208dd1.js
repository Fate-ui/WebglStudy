var g=Object.defineProperty;var v=(o,e,t)=>e in o?g(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var h=(o,e,t)=>(v(o,typeof e!="symbol"?e+"":e,t),t);import{r as u,E as x,V as f,bl as b,c as C,M as L,a as S,b as T,S as M,P as _,W as z,h as A,j as k,m as D}from"./three.module-ca1819de.js";import{O as E}from"./OrbitControls-649546f0.js";import{a as w}from"./index-a86a1d9a.js";import{d as R}from"./index-1a26f821.js";import{F as B}from"./FBXLoader-e51d713d.js";import{d as I,s as N,l as P,p as F,o as G,c as O}from"./index-adae30b7.js";class U{constructor(){h(this,"updateData",()=>{if(!this.isStart)return!1;const e=this.clock.getDelta();this.time.value+=e,this.startTime.value+=e,this.startTime.value>=this.startLength.value&&(this.startTime.value=this.startLength.value)});this.fbxLoader=new B,this.group=new u,this.clock=new x,this.time={value:0},this.startTime={value:0},this.startLength={value:2},this.isStart=!1,this.fbxLoader.load("model/shanghai.FBX",e=>{this.group.add(e),e.traverse(t=>{t.name==="CITY_UNTRIANGULATED"&&(Array.isArray(t.material)?t.material:[t.material]).forEach(a=>{a.transparent=!0,a.color.setStyle("#9370DB")}),t.name==="LANDMASS"&&(Array.isArray(t.material)?t.material:[t.material]).forEach(a=>{a.transparent=!0,a.color.setStyle("#040912")})}),this.init()})}init(){this.isStart=!0,this.clock.start(),this.fly()}fly(){const e={source:{x:-350,y:15,z:10},target:{x:266,y:25,z:2},color:"#efad35",number:150,size:3,period:1.5,opacity:.5},t=new f(e.source.x,e.source.y,e.source.z),s=new f(e.target.x,e.target.y,e.target.z),a=t.clone().lerp(s,.5);a.setY(260);const d=Number.parseInt(t.distanceTo(a)+a.distanceTo(s)),n=new b(t,a,s).getPoints(d),i=new u;for(let c=0;c<e.number;c++){const l=new C(e.size,50,50),r=(c+1)/e.number*.7+.3;l.applyMatrix4(new L().makeScale(r,r,r));const y=new S({color:e.color,transparent:!0,opacity:e.opacity,depthTest:!1}),m=new T(l,y);m.renderOrder=1e3,m.position.copy(n[c]),m.updateMatrix(),i.add(m)}this.group.children[0].add(i),w(()=>{const c=this.time.value%e.period/e.period,l=Number.parseInt(n.length*c);for(let r=0;r<e.number;r++)l+r>=n.length?i.children[r].material.opacity=0:(i.children[r].material.opacity=e.opacity,i.children[r].position.copy(n[l+r]),i.children[r].updateMatrix())})}}const W=U,$=I({__name:"Index",setup(o){const e={width:window.innerWidth,height:window.innerHeight},t=new M,s=new _(50,e.width/e.height,1,1e4);s.position.set(600,750,-1221);const a=new z({antialias:!0});a.setSize(e.width,e.height),a.setPixelRatio(window.devicePixelRatio),a.setClearColor(new A("#32373E"),1);const d=N();P(()=>{d.value.appendChild(a.domElement)});const p=new E(s,a.domElement);t.add(new k(11382189));const n=new D(16777215,5);n.position.set(100,100,0),t.add(n);const i=new W;return t.add(i.group),w(()=>{i.updateData(),p.update(),a.render(t,s)}),F(()=>{R(t,a)}),(c,l)=>(G(),O("div",{ref_key:"containerRef",ref:d},null,512))}});export{$ as default};

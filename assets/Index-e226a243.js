var x=Object.defineProperty;var v=(o,e,t)=>e in o?x(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var u=(o,e,t)=>(v(o,typeof e!="symbol"?e+"":e,t),t);import{r as f,E as b,V as g,bq as _,c as C,M as L,a as S,b as z,S as T,P as M,W as k,h as A,j as B,m as D}from"./three.module-e7d85b12.js";import{O as E}from"./OrbitControls-04cfa186.js";import{a as w}from"./index-10787710.js";import{d as R}from"./index-1a26f821.js";import{F}from"./FBXLoader-4407eb60.js";import{d as N,s as I,l as P,p as G,o as j,c as O,h,F as U}from"./index-28042951.js";class V{constructor(){u(this,"updateData",()=>{if(!this.isStart)return!1;const e=this.clock.getDelta();this.time.value+=e,this.startTime.value+=e,this.startTime.value>=this.startLength.value&&(this.startTime.value=this.startLength.value)});this.fbxLoader=new F,this.group=new f,this.clock=new b,this.time={value:0},this.startTime={value:0},this.startLength={value:2},this.isStart=!1,this.fbxLoader.load("model/shanghai.FBX",e=>{this.group.add(e),e.traverse(t=>{t.name==="CITY_UNTRIANGULATED"&&(Array.isArray(t.material)?t.material:[t.material]).forEach(a=>{a.transparent=!0,a.color.setStyle("#9370DB")}),t.name==="LANDMASS"&&(Array.isArray(t.material)?t.material:[t.material]).forEach(a=>{a.transparent=!0,a.color.setStyle("#040912")})}),this.init()})}init(){this.isStart=!0,this.clock.start(),this.fly()}fly(){const e={source:{x:-350,y:15,z:10},target:{x:266,y:25,z:2},color:"#efad35",number:150,size:3,period:1.5,opacity:.5},t=new g(e.source.x,e.source.y,e.source.z),r=new g(e.target.x,e.target.y,e.target.z),a=t.clone().lerp(r,.5);a.setY(260);const d=Number.parseInt(t.distanceTo(a)+a.distanceTo(r)),n=new _(t,a,r).getPoints(d),i=new f;for(let c=0;c<e.number;c++){const l=new C(e.size,50,50),s=(c+1)/e.number*.7+.3;l.applyMatrix4(new L().makeScale(s,s,s));const y=new S({color:e.color,transparent:!0,opacity:e.opacity,depthTest:!1}),p=new z(l,y);p.renderOrder=1e3,p.position.copy(n[c]),p.updateMatrix(),i.add(p)}this.group.children[0].add(i),w(()=>{const c=this.time.value%e.period/e.period,l=Number.parseInt(n.length*c);for(let s=0;s<e.number;s++)l+s>=n.length?i.children[s].material.opacity=0:(i.children[s].material.opacity=e.opacity,i.children[s].position.copy(n[l+s]),i.children[s].updateMatrix())})}}const W=V,X=h("div",{class:"fixed left-20px top-20px px-20px leading-50px z-1 bg-white rounded"},[h("span",null,"学习来源："),h("a",{href:"https://gitee.com/superzay/threejs-animate",target:"_blank",class:"text-blue"},"threejs 3d开发")],-1),Z=N({__name:"Index",setup(o){const e={width:window.innerWidth,height:window.innerHeight},t=new T,r=new M(50,e.width/e.height,1,1e4);r.position.set(600,750,-1221);const a=new k({antialias:!0});a.setSize(e.width,e.height),a.setPixelRatio(window.devicePixelRatio),a.setClearColor(new A("#32373E"),1);const d=I();P(()=>{d.value.appendChild(a.domElement)});const m=new E(r,a.domElement);t.add(new B(11382189));const n=new D(16777215,5);n.position.set(100,100,0),t.add(n);const i=new W;return t.add(i.group),w(()=>{i.updateData(),m.update(),a.render(t,r)}),G(()=>{R(t,a)}),(c,l)=>(j(),O(U,null,[h("div",{ref_key:"containerRef",ref:d},null,512),X],64))}});export{Z as default};

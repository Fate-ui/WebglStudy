var $=Object.defineProperty;var q=(i,e,t)=>e in i?$(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var d=(i,e,t)=>(q(i,typeof e!="symbol"?e+"":e,t),t),T=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)};var P=(i,e,t)=>(T(i,e,"read from private field"),t?t.call(i):e.get(i)),m=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)};var p=(i,e,t)=>(T(i,e,"access private method"),t);import{O as N}from"./OrbitControls-3a0e138d.js";import{S as Q,M as X,R as Y}from"./StaticGeometryGenerator-e1660f08.js";import{T as Z,V as u,aT as ee,b as B,f as te,$ as oe,g as D,aU as U,y as se,M as ae,S as re,P as ne,W as ie,a5 as ce,a as le,E as de}from"./three.module-d28ad747.js";import{d as he}from"./index-1a26f821.js";import{u as G}from"./index-07359fa6.js";import{G as me}from"./GLTFLoader-c8c5d735.js";import{R as pe}from"./Reflector-1fa02d79.js";import{k as fe,d as ue,s as be,l as ge,p as we,o as ye,c as Se}from"./index-a423d614.js";const ve=[new URL("/WebglStudy/assets/1-91d1fd28.png",self.location).href,new URL("/WebglStudy/assets/2-577e2981.png",self.location).href,new URL("/WebglStudy/assets/3-e96f4416.jpg",self.location).href,new URL("/WebglStudy/assets/4-2c59a331.jpg",self.location).href,new URL("/WebglStudy/assets/5-c8aed110.png",self.location).href,new URL("/WebglStudy/assets/6-9d09d2dc.png",self.location).href,new URL("/WebglStudy/assets/7-68ca4bc6.png",self.location).href,new URL("/WebglStudy/assets/8-74f5f15e.jpg",self.location).href,new URL("/WebglStudy/assets/9-44142f78.jpg",self.location).href,new URL("/WebglStudy/assets/10-1cde4a43.png",self.location).href],V={1:{title:"《小橘贝》",author:"小雅",describe:`
		它站在画面中央，静静地凝视着观众，柔和的橘色将它的柔软毛发和灵动眼眸妩媚地勾勒出来。<br>
		小猫的小耳朵微微竖起，似乎在倾听着什么，身体略微前倾，展现出它对周围世界的好奇和敏感。<br>
		画面的背景色以淡蓝色为主，这种色彩营造了温馨轻柔的氛围，让人仿佛置身于阳光明媚的午后时光中。<br>
		整个画作细致精致、色彩明亮而温暖，带给人们一种温馨、亲切的感受。
		`},2:{title:"《微光》",author:"小雅",describe:`
		微小的星光和银河组成了一个神秘的宇宙世界，让人感到无限的遐想和想象。<br>
		当你凝视着这幅画时，你会感受到无边无际的深邃和宁静。<br>
		你仿佛置身于一个没有噪音、没有烦扰的夜空中。在这个宁静的空间里，你可以看到银河中微光闪烁的样子。<br>
		这些微光似乎是夜空中唯一的生命体，它们微弱却坚定地发出光芒，点亮着整个银河系。<br>
		这些微光是如此的纤细而又强大，仿佛在无边的黑暗中，只有它们才能给人带来希望和力量。
		`},3:{title:"《天鹅》",author:"小雅",describe:`
		湖面静谧如镜，微风拂过，泛起一圈圈细微的涟漪，仿佛为优雅的白色天鹅们铺上了一层晶莹剔透的纱帐。<br>
		其中一只白羽如雪的天鹅在水中自由自在地舞动着优美的姿态，如同一位华丽的舞者在水上翩翩起舞。<br>
		纯白色羽毛在阳光的照射下，闪烁着淡淡的光晕，如同珍珠一般璀璨夺目。
		`},4:{title:"《山中小屋》",author:"小雅",describe:`
		宁静而恬淡，远山隐现于云雾中，仿佛是一幅梦幻般的画卷。<br>
		小屋在山脚下宁静地伫立，墙体洁白，屋顶泛着淡淡的阳光，使得小屋与周围的环境相互映衬。<br>
		流露出一种自然的和谐之美。
		`},5:{title:"《太空人》",author:"小雅",describe:`
		太空人身披着黑夜在星罗棋布的宇宙中漫游。<br>
		虽说现在已经是太空时代，人类早就可以坐太空飞船去月球，<br>
		但却永远无法探索别人内心的宇宙。
		`},6:{title:"《粉色海洋》",author:"小雅",describe:`
		粉色云朵蓬松如棉花糖展开眼前，弯月微笑在缝隙间，月光柔和，清雅动人。<br>
		紫色天空如梦，星辉闪烁，默默倾听，轻轻地，微风拂面，悄悄地，生命在流动。
		`},7:{title:"《风平浪静》",author:"小雅",describe:`
		撑一条船，离开岸边一百米，风平浪静，彩霞慢慢淡下去。<br>
		撑一条船，离开岸边两百米，风平浪静，夜晚轻轻呼唤你。<br>
		撑一条船，离开岸边三百米，风平浪静，大鱼笑我傻兮兮。<br>
		撑一条船 离开岸边四百米，风平浪静，星儿闪闪笑眯眯。<br>
		撑一条船 离开岸边五百米，风平浪静，海龟向我挥手臂。
		`},8:{title:"《向日葵》",author:"小雅",describe:`
		阳光照耀，金黄的花盘。<br>
		宛如一盏明灯，指引前行。<br>
		向日葵，你是信仰，你是力量，你是光辉，你是坚毅，你是忠诚，你是爱慕，你是美丽。
		`},9:{title:"《花·虎·蝶》",author:"小雅",describe:`
		一段奇妙的相遇，是自由和勇气的结合，是一份神秘而又动人的韵味。<br>
		在这片色彩斑斓的花海之中，一只带着蝴蝶翅膀的老虎，骑着踏板车，<br>
		它像是一道闪电，划破了这片美好的天地。<br>
		翅膀轻轻地振动，仿佛随时可以飞离这片美好的天地，飞向更广阔的天空。
		`},10:{title:"《豚》",author:"小雅",describe:`
		所有的转折隐藏在密集的鸟群中，天空与海洋都无法察觉，怀着美梦却可以看见。<br>
		摸索颠倒的一瞬间，所有的怀念隐藏在相似的日子里，心里的蜘蛛模仿人类张灯结彩
		`}},b={width:window.innerWidth,height:window.innerHeight},I=fe();var v,E,_,O,x,z,M,K,R,F;class _e{constructor(e){m(this,v);m(this,_);m(this,x);m(this,M);m(this,R);d(this,"loader",new me);d(this,"textureLoader",new Z);d(this,"modelOffset",new u(0,-5,0));d(this,"collisionScene");d(this,"textureBoards",{});d(this,"galleryBoards",{});d(this,"scene");this.scene=e,p(this,R,F).call(this),p(this,_,O).call(this);const t=[p(this,v,E).call(this),p(this,x,z).call(this)];Promise.all(t).then(()=>{p(this,M,K).call(this)})}}v=new WeakSet,E=function(){const{loader:e,scene:t,modelOffset:o}=this;return new Promise((r,s)=>{e.load("model/scene_collision.glb",c=>{const a=c.scene;this.collisionScene=a,a.position.add(o),a.updateMatrixWorld(!0),a.traverse(n=>{(n.name==="home001"||n.name==="PointLight")&&(n.castShadow=!0),n.name.includes("PointLight")&&n instanceof ee&&(n.intensity*=2e3),n.name==="home002"&&(n.castShadow=!0,n.receiveShadow=!0),n instanceof B&&/gallery.*_board/.test(n.name)&&(this.galleryBoards[n.name]=n)});const h=new Q(this.collisionScene);h.attributes=["position"];const l=h.generate();l.boundsTree=new X(l,{lazyGeneration:!1}),I.value=new B(l),t.add(a),r(c)})})},_=new WeakSet,O=function(){const{loader:e,scene:t,modelOffset:o}=this;return new Promise(r=>{e.load("model/scene_desk_obj.glb",s=>{const c=s.scene;c.position.add(o),t.add(c),r(s)})})},x=new WeakSet,z=async function(){const{textureLoader:e,textureBoards:t}=this,o=[];function r(s){s.colorSpace=D;const c=s.image.width/s.image.height;let a=1,h=1;c>1?a=1/c:h=c,s.offset.set(.5-a/2,.5-h/2),s.repeat.set(a,h)}for(const[s,c]of ve.entries()){const a=new Promise(h=>{e.load(c,l=>{r(l),t[s+1]=l,h(l)})});o.push(a)}return await Promise.all(o),t},M=new WeakSet,K=function(){const{textureBoards:e,galleryBoards:t}=this;for(const o in e){const r=t[`gallery${o}_board`],s=r.material;s.map=e[o],r.userData={name:r.name,title:V[o].title,author:V[o].author,describe:V[o].describe,index:o,src:e[o].image.src,show_boards:!0},[4,5,6,7,9].includes(+o)&&(r.rotation.y=-Math.PI/2),+o==8&&(r.rotation.y=Math.PI)}},R=new WeakSet,F=function(){const e=new pe(new te(100,100),{textureWidth:b.width*window.devicePixelRatio,textureHeight:b.height*window.devicePixelRatio,color:16777215});e.position.add(this.modelOffset),e.material instanceof oe&&(e.material.transparent=!0,e.material.fragmentShader=e.material.fragmentShader.replace("gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 )","gl_FragColor = vec4( blendOverlay( base.rgb, color ), 0.1 )")),e.rotation.x=-Math.PI/2,this.scene.add(e)};const xe=["w","W","ArrowUp"],Me=["s","S","ArrowDown"],Re=["a","A","ArrowLeft"],Le=["d","D","ArrowRight"];var L,k,w,j,A,H,W,J;class ke{constructor(e,t,o){m(this,w);m(this,A);m(this,W);d(this,"moveState",{forward:!1,backward:!1,left:!1,right:!1,jump:!1});d(this,"character");d(this,"orbitController");d(this,"camera");d(this,"moveInfo",{tempVector:new u,upVector:new u(0,1,0),velocity:new u,speed:12,jumpHeight:100,gravity:-50});d(this,"capsule_info",{radius:1,segment:new U(new u,new u(0,-5,0))});d(this,"temp_box",new se);d(this,"temp_mat",new ae);d(this,"temp_segment",new U);d(this,"temp_vector2",new u);m(this,L,e=>{p(this,w,j).call(this,e,!0),this.moveState.jump,e.key===" "&&!this.moveState.jump&&(this.moveState.jump=!0,this.moveInfo.velocity.y=this.moveInfo.jumpHeight)});m(this,k,e=>{p(this,w,j).call(this,e,!1)});d(this,"update",e=>{p(this,A,H).call(this,e),I.value&&p(this,W,J).call(this,e,I.value);const{character:t,orbitController:o,camera:r}=this;r.position.sub(o.target),o.target.copy(t.position),r.position.add(t.position)});this.character=e,this.orbitController=t,this.camera=o,G("keydown",P(this,L)),G("keyup",P(this,k))}}L=new WeakMap,k=new WeakMap,w=new WeakSet,j=function(e,t){if(xe.includes(e.key)){this.moveState.forward=t;return}if(Me.includes(e.key)){this.moveState.backward=t;return}if(Re.includes(e.key)){this.moveState.left=t;return}if(Le.includes(e.key)){this.moveState.right=t;return}},A=new WeakSet,H=function(e){const{forward:t,backward:o,left:r,right:s,jump:c}=this.moveState,{tempVector:a,velocity:h,speed:l,upVector:n,gravity:g}=this.moveInfo,{character:f,orbitController:y,camera:C}=this;c?h.y+=g*e:h.y=e*g,f.position.addScaledVector(h,e);const S=y.getAzimuthalAngle();t&&(a.set(0,0,-1).applyAxisAngle(n,S),f.position.addScaledVector(a,l*e)),o&&(a.set(0,0,1).applyAxisAngle(n,S),f.position.addScaledVector(a,l*e)),r&&(a.set(-1,0,0).applyAxisAngle(n,S),f.position.addScaledVector(a,l*e)),s&&(a.set(1,0,0).applyAxisAngle(n,S),f.position.addScaledVector(a,l*e)),f.updateMatrixWorld()},W=new WeakSet,J=function(e,t){var a,h;const o=this.capsule_info;this.temp_box.makeEmpty(),this.temp_mat.copy(t.matrixWorld).invert(),this.temp_segment.copy(o.segment),this.temp_segment.start.applyMatrix4(this.character.matrixWorld).applyMatrix4(this.temp_mat),this.temp_segment.end.applyMatrix4(this.character.matrixWorld).applyMatrix4(this.temp_mat),this.temp_box.expandByPoint(this.temp_segment.start),this.temp_box.expandByPoint(this.temp_segment.end),this.temp_box.min.addScalar(-o.radius),this.temp_box.max.addScalar(o.radius),(h=(a=t.geometry)==null?void 0:a.boundsTree)==null||h.shapecast({intersectsBounds:l=>l.intersectsBox(this.temp_box),intersectsTriangle:l=>{this.moveInfo.tempVector;const n=this.moveInfo.tempVector,g=this.temp_vector2,f=l.closestPointToSegment(this.temp_segment,n,g);if(f<o.radius){const y=o.radius-f,C=g.sub(n).normalize();this.temp_segment.start.addScaledVector(C,y),this.temp_segment.end.addScaledVector(C,y)}}});const r=this.moveInfo.tempVector;r.copy(this.temp_segment.start).applyMatrix4(t.matrixWorld);const s=this.temp_vector2;s.subVectors(r,this.character.position),this.moveState.jump=s.y<=Math.abs(e*this.moveInfo.velocity.y*.25);const c=Math.max(0,s.length()-1e-5);s.normalize().multiplyScalar(c),this.character.position.add(s),this.moveState.jump?this.moveInfo.velocity.set(0,0,0):(s.normalize(),this.moveInfo.velocity.addScaledVector(s,-s.dot(this.moveInfo.velocity)))};const Ue=ue({__name:"Index",setup(i){const e=new re,t=new ne(50,b.width/b.height,1,9e3);t.position.set(0,0,3);const o=new ie({antialias:!0});o.setSize(b.width,b.height),o.setPixelRatio(window.devicePixelRatio),o.shadowMap.enabled=!0,o.outputColorSpace=D,o.toneMapping=ce;const r=be();ge(()=>{r.value.appendChild(o.domElement)});const s=new N(t,o.domElement);s.minDistance=1e-4,s.maxDistance=1e-4,new _e(e);const c=new B(new Y(.5,2.5,.5,10,1),new le({color:255}));c.geometry.translate(0,-.25,0);const a=new ke(c,s,t);e.add(c);const h=new de;return o.setAnimationLoop(()=>{o.render(e,t),s.update();const l=h.getDelta();a.update(l)}),we(()=>{he(e,o)}),(l,n)=>(ye(),Se("div",{ref_key:"containerRef",ref:r},null,512))}});export{Ue as default};
